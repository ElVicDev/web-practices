<!--
  Este ejemplo amplía nuestro ejemplo de matriz para que puedas 
  visualizar una imagen haciendo clic en ella. Utiliza dos plantillas, 
  una para ver miniaturas y otra para ver una sola imagen.
  Nota: he encontrado un error en este código desde que hice el video. 
  Intenta encontrarlo e incluso solucionarlo.
-->

<!DOCTYPE html>
<html lang="en">
  <head>

  <!-- Incluya nuestras bibliotecas y archivos css. -->
  <script src="js/jquery-2.1.4.min.js"></script>
  <script src="js/handlebars-v3.0.3.js"></script>


  <script src="js/bootstrap.min.js"></script>

  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/gallery.css" rel="stylesheet">

  </head>

  <body role="document">

    <div class="container">

      <!-- El título de la página. -->
      <div class="page-header">
        <h1>My photo albums </h1>
      </div>


      <!--
        El cuadro de búsqueda.
        Se le asigna la clase navbar-form para que bootstrap lo coloque 
        en la barra de navegación superior
      -->
      <div class="navbar-form navbar-right">
        <input id="searchbox" type="text" class="form-control" placeholder="Search...">
      </div>

      <!--
        En realidad, no usamos estas pestañas de navegación en este ejemplo, 
        pero las incluí para que la navegación superior se vea bien y 
        podamos ampliar el ejemplo más adelante para usarlas.
      -->
      <ul class="nav nav-tabs">
        <li role=""  id="detailsbtn"><a href="#">Details</a></li>
        <li role="" id="modalbtn"><a href="#">Modal</a></li>
      </ul>
      <br/><br/>

      <!--
        El contenido de la página web comienza vacío porque lo 
        completaremos más adelante a partir de la plantilla.
        Usamos container-fluid porque nuestra plantilla utiliza 
        la cuadrícula de bootstrap.
      -->
      <div id="content"  class="container-fluid"  role="main">
      </div>

      <!--
        Este div contendrá el cuadro de diálogo modal que 
        mostrará la imagen grande.
      -->
      <div id="modal-container"  >
      </div>
    </div>

    <!--
      Esta plantilla muestra muchas fotos en un álbum. 
      Utiliza la etiqueta de plantilla {{#each}} que repite 
      la parte interna de la plantilla para cada elemento de una matriz.
    -->
    <script id="album-template" type="text/x-handlebars-template">
      <div class="row">
        {{#each images}}
        <div class="col-xs-12 col-md-3">
          <div class="thumbnail" data-id="{{@index}}">
            <img class="crop-img" src="{{src}}" alt=""/>
              <div class="author">
                <h3> {{title}} </h3>
                <p> {{author}} </p>
              </div>
          </div>
        </div> <!-- / col -->
        {{/each}}
      </div> <!-- / row -->
    </script>

    <!--
      Esta segunda plantilla muestra una ventana emergente modal de la imagen. 
      Tiene bastante código HTML repetitivo, pero en esencia solo muestra una 
      etiqueta de imagen dentro de un conjunto de divs que definen el modal.
    -->
    <script id="modal-template" type="text/x-handlebars-template">
      <div id="imageModal" class="modal fade" role="dialog">
        <div class="modal-dialog"  style="width:800">

          <div class="modal-content">

            <div class="modal-body">
              <img  style="width:100%" src="{{src}}"/>
            </div>

          </div>

        </div>
      </div>
    </script>
  </body>

    <!--
      El código javascript para instanciar la plantilla.
    -->
    <script type="text/javascript">
      // Obtenga el código fuente de nuestras dos plantillas y compílelas.
      var source   = $("#album-template").html();
      var template = Handlebars.compile(source);

      source   = $("#modal-template").html();
      var modal_template = Handlebars.compile(source);

      // Definimos los datos de la plantilla. 
      // Definimos un objeto que contiene una matriz de otros objetos. 
      // Esta matriz se utilizará para crear varias imágenes.
      var data = {images:[
        {
          src: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Shopping_Center_Magna_Plaza_Amsterdam_2014.jpg/600px-Shopping_Center_Magna_Plaza_Amsterdam_2014.jpg",
          title: "Shopping Center Magna Plaza Amsterdam 2014",
          author: "Tuxyso",
        },
        {
          src: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/600px-The_Earth_seen_from_Apollo_17.jpg", 
          title: "The Earth seen from Apollo 17",
          author: "Ed g2s"
        },
        {
          src: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Barnard_33.jpg/300px-Barnard_33.jpg",
          title: "Horse nebula",
          author: "John Smith",
        },
        {
          src: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Women_Working_in_WWII.jpg/640px-Women_Working_in_WWII.jpg",
          title: "WWII Women Working",
          author: "Library of Congress Prints & Photographs Division",
        },
        {
          src: "http://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Lijiang_Yunnan_China-Naxi-people-carrying-baskets-01.jpg/300px-Lijiang_Yunnan_China-Naxi-people-carrying-baskets-01.jpg",
          title: "Lijiang Yunnan China Naxi people carrying baskets",
          author: "Wikimedia Commons",
        },
        {
          src: "http://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Stift_G%C3%B6ttweig_Gobelinzimmer_01.JPG/300px-Stift_G%C3%B6ttweig_Gobelinzimmer_01.JPG",
          title: "Marco's house",
          author: "Wikimedia Commons",
        },
      ]};

      // Representar los datos en la plantilla.
      var html    = template(data);
      // Coloque la plantilla renderizada en el DOM.
      $('#content').html(html);

      // Una función para mostrar una imagen en la que se hizo clic como un modal.
      // Se agrega como una devolución de llamada de clic a las miniaturas.
      function displayModal(event){
          // Obtiene el índice (posición en la matriz) de la foto en la que hicimos clic.
          // "this" es el elemento en el que hicimos clic.
          // data("id") obtiene el atributo data-id 
          // (que configuramos en el índice de la foto en la matriz - @index)
          var imageNumber = $(this).data("id");

          // Obtenga la imagen de la matriz utilizando el número de imagen 
          // y representela utilizando la plantilla modal.
          var html    = modal_template(data.images[imageNumber]);
          // Coloque la plantilla modal en el DOM.
          $('#modal-container').html(html);

          // Mostrar el modal.
          $("#imageModal").modal('show');
      }

      // Muestra el modal cuando haces clic en una miniatura.
      $('.thumbnail').click(displayModal);

      // La funcionalidad de búsqueda ocurre cuando 
      // se presiona una tecla dentro del cuadro de búsqueda.
      $('#searchbox').keypress(function (e) {

        // Comprueba si la tecla que se presionó es la tecla de 
        // retorno (tiene id 13) y solo haz la búsqueda si lo es.
        if (e.which == 13) {

          // Obtenga el texto de búsqueda que es el contenido del cuadro de búsqueda.
          var search_text = $('#searchbox').val();

          // Imprima el cuadro de búsqueda 
          // (este es un ejemplo del uso de console.log para depuración).
          console.log(search_text)

          // Crea una nueva matriz de datos con solo los datos 
          // que contienen la cadena de búsqueda.
          var filteredData = {

            // Utilice la función de filtro que devuelve una nueva matriz 
            // que contiene solo los elementos de data.images para los que 
            // la función devuelve verdadero.
            images: data.images.filter(function(d){

              // Devuelve verdadero si el título contiene el texto de búsqueda.
              if (d.title.search(search_text) > -1){
                return true;
              }

              // Devuelve verdadero si el autor contiene el texto de búsqueda.
              if (d.author.search(search_text) > -1){
                return true;
              }

              // Si llegamos aquí significa que no hemos encontrado ninguna coincidencia, 
              // por lo que devolvemos falso.
              return false;
            })
          };

          // Pase los datos recién filtrados a la plantilla para generar nuevo HTML.
          var html    = template(filteredData);
          $('#content').html(html);

          // Muestra el modal cuando haces clic en una miniatura.
          $('.thumbnail').click(displayModal);
        }
      });

    </script>

  </body>
</html>